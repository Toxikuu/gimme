name: libdrm
version: 2.4.123
url: "https://dri.freedesktop.org/libdrm/libdrm-${version}.tar.xz"
get: |
  ls && mkdir build && cd build
  meson setup --prefix=$XORG_PREFIX \
              --buildtype=release \
              -D udev=true \
              -D valgrind=disabled \
              -D intel=disabled \
              -D radeon=disabled \
              -D amdgpu=disabled \
              -D nouveau=disabled \
              -D vmwgfx=disabled \
              -D tests=false \
              -D cairo-tests=disabled \
              .. &&
  ninja && sudo ninja install &&
  rm -rvf * &&
  CC="gcc -m32" CXX="g++ -m32"                 \
  PKG_CONFIG_PATH=$XORG_PREFIX/lib32/pkgconfig \
  meson setup --prefix=$XORG_PREFIX            \
              --buildtype=release              \
              --libdir=$XORG_PREFIX/lib32      \
              -D udev=true                     \
              -D valgrind=disabled             \
              -D intel=disabled \
              -D radeon=disabled \
              -D amdgpu=disabled \
              -D nouveau=disabled \
              -D vmwgfx=disabled \
              -D tests=false \
              -D cairo-tests=disabled \
              .. &&
  ninja &&
  sudo DESTDIR=$PWD/DESTDIR ninja install &&
  sudo cp -vr DESTDIR/$XORG_PREFIX/lib32/* $XORG_PREFIX/lib32 &&
  sudo rm -rf DESTDIR &&
  sudo ldconfig
remove: |
  cd build &&
  sudo ninja uninstall
